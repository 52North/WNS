<?xml version="1.0"?>
<project name="52North WNS xmlbindings" default="bindings" basedir="../..">

	<!-- ==================================================
	 ==	properties needed for build the XML bindings ==
     ================================================== -->
	
	<!-- needed while xmlbean compiling -->
	<property name="generated-sources" value="${basedir}/.xmlbeans/sources" />
	<property name="generated-classes" value="${basedir}/.xmlbeans/classes" />

	<property name="xsd.location" value="${basedir}/xml/xsd" />

	<property name="jar.binding" value="52nWNS_RFC.jar" />

	<property name="lib" value="${basedir}/WebContent/WEB-INF/lib" />
	<!-- ================================
	 == initialise the environment ==
     ================================ -->
	<target name="init">
				
		<!-- check for xmlbean.jar and define xbean task -->
		<available property="xmlbeans.lib" value="${lib}" file="${lib}/xbean.jar" />
		<fail message="You must include the xmlbeans libraries in the lib folder." unless="xmlbeans.lib" />
		<echo message="xmlbeans.lib: ${xmlbeans.lib}" />

		<path id="xmlbeans.path">
			<fileset dir="${lib}" includes="xbean.jar" />
		</path>
		<taskdef name="xmlbean" classname="org.apache.xmlbeans.impl.tool.XMLBean" classpathref="xmlbeans.path" />
	</target>

	<!-- ===============================
	 == Generate bindings ==
     =============================== -->
	<target name="bindings" depends="init">

		<!-- cleanup before generation -->
		<delete failonerror="true" file="${lib}/${jar.binding}" />

		<!-- compile schemas -->
		<xmlbean classgendir="${generated-classes}" srcgendir="${generated-sources}" memoryMaximumSize="512m" failonerror="true" download="true" classpathref="xmlbeans.path">

			<fileset dir="${xsd.location}">
				<include name="**/*.xsd" />
			</fileset>

		</xmlbean>

		<jar basedir="${generated-classes}" destfile="${lib}/${jar.binding}" update="true"/>

		<!-- cleanup after generation -->
		<delete failonerror="false" dir="${generated-classes}" />
		<delete failonerror="false" dir="${generated-sources}" />

	</target>

</project>
